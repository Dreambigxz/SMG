<app-header2></app-header2>
<app-spinner></app-spinner>

  <!-- <div *ngIf="!walletService.initialized_currency" class="blur-overlay">
  </div> -->


  <div class="page">
      <section class="app-container container-fluid ">

      <div class="deposit-page">


        <!-- CURRENCY SWITCH -->
        <div class="currency-switch">
          <button
            *ngIf="!storeData.store['wallet']?.payment_method||storeData.store['wallet']?.payment_method&&walletService.cryptoCoins.includes(storeData.store['wallet']?.payment_method)"
            [class.active]="activeCurrency === 'crypto'"
            (click)="switchCurrency('crypto')"

          >
            Crypto
          </button>

          <button
          *ngIf="!storeData.store['wallet']?.payment_method||storeData.store['wallet']?.payment_method&&!walletService.cryptoCoins.includes(storeData.store['wallet']?.payment_method)"
            [class.active]="activeCurrency === 'bank'"
            (click)="switchCurrency('bank')"
          >
            Bank
          </button>
        </div>


      <!-- NETWORK -->
      <div class="tab-1" *ngIf="activeCurrency === 'crypto'">

        <div class="space-between mt-7 mb-1">
          <div class="network-select">
            <span>Network</span>
            <p></p>
          </div>

          <div class="custom-select-wrapper " >
              <div class="custom-select-trigger" (click)="walletService.toggleDropdown()">
                <img *ngIf="walletService.SelectedCryptoImg" [src]="walletService.SelectedCryptoImg" alt="" class="crypto-img">
                {{ walletService.SelectedCrypto || 'Select Currency' }}
                <span class="arrow">&#9662;</span>
              </div>

              <div class="custom-options" [class.show]="walletService.dropdownOpen">
                <div
                  class="custom-option"
                  *ngFor="let crypto of walletService.cryptos"
                  (click)="walletService.selectCrypto(crypto,walletService.formView['deposit'])"
                >
                  <img *ngIf="crypto.img" [src]="crypto.img" alt="" class="crypto-img">
                  {{ crypto.label }}
                </div>
              </div>
            </div>
        </div>

        <!-- INFO LIST -->
          <div class="info-list">
            <div class="info-item">
              <span>Minimum Deposit</span>
              <span>{{walletService.minimumPayment|number:"1.2-2"}} {{walletService.selectedCurrency?.code}}</span>
            </div>

            <div class="info-item">
              <span>Total Deposited</span>
              <span>{{storeData.store['wallet']?.history.deposit|currencyConverter:true}}</span>
            </div>

            <div class="info-item">
              <span>Deposit Arrival</span>
              <span>20 confirmations</span>
            </div>

            <div class="info-item">
              <span>Contract Address</span>
              <span class="link">Ending with {{tempAdd| slice:-5}}</span>
            </div>
          </div>

          <div  class="alert alert-info d-flex  align-items-center gap-1 mt-5" role="alert">
            <i class="ti ti-alert-triangle fs-5 text-warning"></i>
            <span class="color" *ngIf="walletService.selectedCurrency?.code === 'USD'">
              <strong class="text-deem">Deposit Instructions:</strong> Copy and send only <strong>USDT-TRC20</strong> payment to the address below.

            </span>
            <span class="color" *ngIf="walletService.selectedCurrency?.code  === 'TRON'">
              <strong>Deposit Instructions:</strong> Copy and send only <strong>TRON</strong> payment to the address below.

            </span>
          </div>

          <!-- ADDRESS -->
          <div  class="address-card">
            <span class="label">Wallet Address</span>
            <div class="address-row">
              <code>{{tempAdd}}</code>
              <button (click)="walletService.copyContent(tempAdd)"><i class="ti ti-copy"></i></button>
            </div>
          </div>

          <!-- ACTIONS -->
          <!-- <div class="deposit-actions">
            <button class="btn-outline">Save Picture</button>
            <button class="btn-primary">Copy Address</button>
          </div> -->

        <!-- QR CARD -->
        <div *ngIf="tempAdd" class="qr-card text-center mt-3">
          <qrcode [qrdata]="tempAdd" [width]="150" [errorCorrectionLevel]="'M'"></qrcode>
        </div>




      </div>

      <div class="tab-2" *ngIf="activeCurrency === 'bank'">
        <!-- Local bank UI goes here -->

        <div class="space-between mt-7 mb-1">
          <div class="network-select">
            <span>Network</span>
            <p></p>
          </div>
          <div *ngIf="!storeData.store['deposit']?.length" class="custom-select-wrapper" >
            <div class="custom-select-trigger" (click)="walletService.toggleDropdown()">
              <img *ngIf="walletService.init_local" src="https://flagsapi.com/{{walletService.init_payment_method| slice:0:2}}/flat/64.png" alt="" class="crypto-img">

              {{ walletService.SelectedBank || 'Select Currency' }}
              <span class="arrow">&#9662;</span>
            </div>

              <div class="custom-options" [class.show]="walletService.dropdownOpen">
              <div
                class="custom-option"
                *ngFor="let c of walletService.initCurrencies.slice(2)"
                (click)="walletService.selectLocal(c,walletService.formView['deposit'])"
              >
                <img  src="https://flagsapi.com/{{c.code| slice:0:2}}/flat/64.png" alt="" class="crypto-img">
                {{ c.name }}
              </div>
            </div>
          </div>
        </div>

        <div class="info-list">
          <div class="info-item">
            <span>Minimum Deposit</span>
            <span>{{walletService.minimumPayment|number:"1.2-2"}} {{walletService.selectedCurrency?.code}}</span>
          </div>

          <div class="info-item">
            <span>Total Deposited</span>
            <span>{{storeData.store['wallet']?.history.deposit|currencyConverter:true}}</span>
          </div>

          <div class="info-item">
            <span>Deposit Arrival</span>
            <span>2-30 Minutes</span>
          </div>


        </div>

        <div *ngIf="!walletService.cryptoCoins.includes(walletService.selectedCurrency.code)">
          <div *ngIf="!storeData.store['deposit']?.length" class="card">
            <!-- form -->
            <form   [formGroup]="walletService.formView['deposit']" (ngSubmit)="walletService.handleSubmit(walletService.formView['deposit'],'create_deposit')">

                <div  class="mb-3">
                  <!-- Amount Input -->
                  <label>Amount</label>
                  <input
                    type="number"
                    [(ngModel)]="amount"
                    placeholder="Min {{walletService.selectedCurrency?.symbol}}{{walletService.minimumPayment}}"
                    [min]="walletService.minimumPayment"
                    class=" mb-3"
                    formControlName="amount"
                  >
                </div>


              <button
                type="submit"
                [disabled]="!walletService.formView['deposit'].valid||walletService.init_local!==true"
                class="">Submit <i class="ti ti-arrow-right"></i>
              </button>

            </form>
          </div>
        </div>

        <!-- displaylocal Deposit info list -->
        <div *ngIf="storeData.store['deposit']?.length">

          <!-- <div class="info-list">
            <div class="info-item">
              <span>Amount Deposit</span>
              <span>{{storeData.store['deposit'][0].amount|currencyConverter:true:storeData.store['deposit'][0].method}} {{walletService.selectedCurrency?.code}}</span>
            </div>

            <div class="info-item">
              <span>Total Deposited</span>
              <span>{{walletService.selectedCurrency?.symbol}}{{storeData.store['wallet']?.history.deposit|number:"2.1-1"}}</span>
            </div>

            <div class="info-item">
              <span>Deposit Arrival</span>
              <span>20 confirmations</span>
            </div>

            <div class="info-item">
              <span>Contract Address</span>
              <span class="link">Ending with {{tempAdd| slice:-5}}</span>
            </div>
          </div> -->

          <div class="text-right mt-3">
            <small  (click)="walletService.cancelPayment('deposit')" class="text-danger "> <i class="ti ti-trash fs-five"></i> Cancel payment</small>
          </div>

          <div  class="alert alert-info  d-flex align-items-center gap-2 mt-5" role="alert">
            <i class="ti ti-alert-triangle fs-5 text-warning"></i>
            <span *ngIf="storeData.store['local_banks']&&storeData.store['local_banks'][0]?.automatic" class="color">
                Click the Payment Page link below to complete your payment!
                <br>
                <button (click)="goToPaymentPage(storeData.store['deposit'][0])" class="btn btn" type="button" name="button">
                  Payment Page <i class="ti ti-arrow-right"></i>
                </button>
            </span>
            <span *ngIf="storeData.store['local_banks']&&!storeData.store['local_banks'].automatic&&!storeData.store['deposit'][0].proof&&storeData.store['deposit'][0].generator!=='awaiting_deposit_confirmation';else paymentProofText" class="color">
                Send your invoice amount to any of our verified bank and {{storeData.store['local_banks'].currency==='NGN'?'click on the payment completed button.':'upload the payment receipt.'}}
                <!-- upload receipt completed to upload your proof. -->
            </span>
            <ng-template #paymentProofText >
              <span
                [class.text-success]="walletService.previewUrl"
                class="color">
                  Your {{storeData.store['deposit'][0].amount|currencyConverter:true:storeData.store['deposit'][0].method}} deposit is currently awaiting confirmation.
                  <!-- <span class="color mt-4">Note: Bank network could be delayed: payment takes up to 0- 3 hours to reflect.</span> -->
              </span>
              </ng-template>

          </div>

          <div *ngIf="storeData.store['local_banks']&&!storeData.store['local_banks'].automatic">

            <div *ngIf="storeData.store['local_banks'] as banks">

              <div *ngIf="!storeData.store['deposit'][0].proof&&storeData.store['deposit'][0].generator!=='awaiting_deposit_confirmation';else awaitingpaymentConfirmationBlock">


                <div class="widget item-widget">
                      <div class="widget-body">

                        <!-- Tabs -->
                        <div class="item-tabs">
                          <button
                            *ngFor="let bank of banks; let i = index"
                            class="item-tab"
                            [class.active]="activeBankIndex === i"
                            (click)="setActiveBank(i)"
                          >
                            {{ bank.bank }}
                          </button>
                        </div>

                        <!-- Content -->
                        <div class="item-card" *ngIf="activeBank as bank">

                          <div class="item-row">
                            <span class="label">
                              {{ bank.currency === 'AOA' ? 'IBAN' : 'Account Number' }}
                            </span>

                            <div class="value copy-row">
                              <span>{{ bank.account_number }}</span>
                              <button
                                class="copy-btn"
                                (click)="walletService.copyContent(bank.account_number)"
                              >
                                <i class="ti ti-copy"></i>
                              </button>
                            </div>
                          </div>

                          <div class="item-row">
                            <span class="label">Account Name</span>
                            <span class="value">{{ bank.account_holder }}</span>
                          </div>

                          <div class="item-row">
                            <span class="label">Bank Name</span>
                            <span class="value">{{ bank.bank }}</span>
                          </div>

                        </div>

                      </div>
                    </div>


                  <div class="payment-completed">
                    <button *ngIf="!walletService.sendSendersName&&storeData.store['local_banks'].currency==='NGN'" (click)="walletService.sendSendersName=true" style="font-size: 10px;" class="cmn-btn btn-sm text-center payment-completed" type="button" name="button">Payment completed</button>

                  </div>
              </div>

            </div>

            <div class="text-cente mt-4">
            </div>


            <ng-template #awaitingpaymentConfirmationBlock>

              <div *ngIf="storeData.store['deposit'][0] as deposit" class="item-card">
                <div class="item-row">
                  <span class="label">Amount</span>
                  <span class="value">{{ deposit.amount|currencyConverter:true:storeData.store['deposit'][0].method }}</span>
                </div>
                <div class="item-row">
                  <span class="label">Initiated at</span>
                  <span class="value">{{deposit.timestamp|timeFormat:"fullDate"}}</span>
                </div>
                <div class="item-row">
                  <span class="label">Awaiting time left</span>
                  <span class="value">{{deposit.timestamp|countdown:3|async}}</span>
                </div>
              </div>
              <!-- <ul *ngIf="storeData.store['deposit'][0] as deposit" class="item-flex-list">
                <li><span class="text-first">Amount:</span> <span>{{ deposit.amount|currencyConverter:true:storeData.store['deposit'][0].method }}</span></li>
                <li><span class="text-first">Created at:</span><span>{{deposit.timestamp|timeFormat:"fullDate"}}</span></li>
                <li><span class="text-first">Confirming:</span> <span class="text-deem"> {{deposit.timestamp|countdown:3|async}} </span></li>
              </ul> -->
            </ng-template>



            <div *ngIf="storeData.store['local_banks'].currency!=='NGN';else attachSendersNameBlock" class="upload-wrapper mb-3 mt-5 text-center ">
              <div class="">
                <label for="fileInput">
                  <img
                    [src]="storeData.store['deposit']?.[0]?.proof || defaultImage"
                    class="upload-preview"
                    alt="Upload preview"
                  />
                </label>
                <input
                  type="file"
                  id="fileInput"
                  hidden
                  accept="image/*"
                  (change)="walletService.onImageSelected($event)"
                >
                <small *ngIf="" class="error"></small>

              </div>

              <h6 *ngIf="!walletService.previewUrl" class="text-deem" style="display:flex;justify-content:center" >Upload Receipt</h6>

            </div>

            <ng-template #attachSendersNameBlock>

              <!-- <h6 class="text-deem" style="display:flex;justify-content:center" *ngIf="!walletService.previewUrl;else attachSendersNameBlock">Upload Receipt</h6> -->

                <div *ngIf="!storeData.store['deposit'][0].proof&&walletService.sendSendersName">
                  <input
                    [(ngModel)]="walletService.localDepositSendersName"
                    type="text"
                    placeholder="Senders Name"
                    class="n11-bg mb-3"
                  />
                  <span></span>

                  <!-- [class.inactive-btn]="!walletService.selectedFile||!walletService.localDepositSendersName" -->

                  <button
                    type="submit"
                    [class.disabled]="!walletService.localDepositSendersName"
                    (click)="walletService.paymentCompleted()"
                    >
                    SEND <i class="ti ti-arrow-right"></i>
                  </button>
                </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
    </section>

  </div>
