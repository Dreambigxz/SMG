<app-header2></app-header2>
<app-spinner></app-spinner>

<div class="page page-wrapper ">

  <section *ngIf="historyServiceLoaded" class="app-container mt-12">

    <!-- BET TABS -->
    <div class="bets-tabs mb-4">
      <button
        [class.active]="activeTab === 'openbet'"
        (click)="switchTab('openbet')">
        Open Bets ({{ historyServiceLoaded.openBetDisplay.length }})
      </button>

      <button
        [class.active]="activeTab === 'settled'"
        (click)="switchTab('settled')">
        Settled Bets ({{ historyServiceLoaded.settledBets.length }})
      </button>
    </div>

    <!-- OPEN BETS -->
    <div *ngIf="activeTab === 'openbet'" class="bets-content">
      <ng-container *ngIf="historyServiceLoaded.openBetDisplay.length; else emptyOpen">
        <div *ngFor="let bet of historyServiceLoaded.openBetDisplay" class="bet-card">
          <div class="bet-header d-flex justify-content-between align-items-center">
            <div class="bet-league">
              <img [src]="bet.fixture[0].league.logo" alt="League Logo" class="league-logo">
              <span>{{ bet.fixture[0].league.name }}</span>

            </div>

            <ng-template #displayStatus >
              <span class="bet-status live">Live</span>
            </ng-template>
          </div>

          <div class="bet-teams d-flex justify-content-between align-items-center mt-2">
            <div class="team">
              <img [src]="bet.fixture[0].teams.home.logo" alt="Home Team" class="team-logo">
              <span>{{ bet.fixture[0].teams.home.name }}</span>
            </div>
            <span class="vs">vs</span>
            <div class="team">
              <img [src]="bet.fixture[0].teams.away.logo" alt="Away Team" class="team-logo">
              <span>{{ bet.fixture[0].teams.away.name }}</span>
            </div>
          </div>

          <div class="bet-info d-flex justify-content-between align-items-center mt-2">
            <span>Score: {{ addScore(bet) }}</span>
            <span>Odds: {{ bet.market_odds }}</span>
          </div>

          <div class="bet-footer mt-2 d-flex justify-content-between align-items-center">
            <span>Stake: {{ bet.stake_amount | currency }}</span>
            <button
              *ngIf="bet.status==='open'&&bet.fixture[0].fixture.timestamp |countdown|async as time;else displayStatus"
              (click)="historyServiceLoaded.CancelTicket(bet)"
              class="btn-cancel">
              Cancel
            </button>
          </div>
        </div>
      </ng-container>

      <ng-template #emptyOpen>
        <div class="empty-state">
          <img src="assets/images/empty-box.png" alt="No open bets">
          <p>No open bets found</p>
        </div>
      </ng-template>
    </div>

    <!-- SETTLED BETS -->
    <div *ngIf="activeTab === 'settled'" class="bets-content">
      <ng-container *ngIf="historyServiceLoaded.settledBets.length; else emptySettled">
        <div *ngFor="let bet of historyServiceLoaded.settledBets" class="bet-card">
          <div class="bet-header d-flex justify-content-between align-items-center">
            <div class="bet-league">
              <img [src]="bet.fixture[0].league.logo" alt="League Logo" class="league-logo">
              <span>{{ bet.fixture[0].league.name }}</span>
            </div>
            <span class="bet-status"
                  [ngClass]="{
                    'won': bet.status==='won',
                    'loss': bet.status==='loss' || bet.status==='lost',
                    'cancel': bet.status==='cancel'
                  }">
              {{ bet.status | titlecase }}
            </span>
          </div>

          <div class="bet-teams d-flex justify-content-between align-items-center mt-2">
            <div class="team">
              <img [src]="bet.fixture[0].teams.home.logo" alt="Home Team" class="team-logo">
              <span>{{ bet.fixture[0].teams.home.name }}</span>
            </div>
            <span class="vs">vs</span>
            <div class="team">
              <img [src]="bet.fixture[0].teams.away.logo" alt="Away Team" class="team-logo">
              <span>{{ bet.fixture[0].teams.away.name }}</span>
            </div>
          </div>

          <div class="bet-info d-flex justify-content-between align-items-center mt-2">
            <span>Score: {{ addScore(bet) }}</span>
            <span>Odds: {{ bet.market_odds }}</span>
          </div>

          <div class="bet-footer mt-2 d-flex justify-content-between align-items-center">
            <span>Stake: <span class="stake-amount">{{ bet.stake_amount | currency }}</span></span>
            <span>Total Win: <span class="total-winning">{{ setProfit(bet,true) | currency }}</span></span>
          </div>
        </div>
      </ng-container>

      <ng-template #emptySettled>
        <div class="empty-state">
          <img src="assets/images/empty-box.png" alt="No settled bets">
          <p>No settled bets found</p>
        </div>
      </ng-template>
    </div>

  </section>
</div>

<app-menu-bottom></app-menu-bottom>
